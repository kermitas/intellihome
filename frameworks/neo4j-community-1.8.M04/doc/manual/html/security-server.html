<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>25.1. Securing access to the Neo4j Server</title><link rel="stylesheet" href="docbook-xsl.css" type="text/css" /><meta name="generator" content="DocBook XSL Stylesheets V1.75.2" /><link rel="home" href="index.html" title="The Neo4j Manual v1.8.M04" /><link rel="up" href="operations-security.html" title="Chapter 25. Security" /><link rel="prev" href="operations-security.html" title="Chapter 25. Security" /><link rel="next" href="operations-monitoring.html" title="Chapter 26. Monitoring" /><link rel="preface" href="preface.html" title="Preface" /><link rel="part" href="introduction.html" title="Part I. Introduction" /><link rel="chapter" href="introduction-highlights.html" title="Chapter 1. Neo4j Highlights" /><link rel="chapter" href="graphdb-concepts.html" title="Chapter 2. Graph Database Concepts" /><link rel="chapter" href="graphdb-neo4j.html" title="Chapter 3. The Neo4j Graph Database" /><link rel="part" href="tutorials.html" title="Part II. Tutorials" /><link rel="chapter" href="tutorials-java-embedded.html" title="Chapter 4. Using Neo4j embedded in Java applications" /><link rel="chapter" href="cypher-cookbook.html" title="Chapter 5. Cypher Cookbook" /><link rel="chapter" href="tutorials-rest.html" title="Chapter 6. Neo4j Remote Client Libraries" /><link rel="chapter" href="server-extending.html" title="Chapter 7. Extending the Neo4j Server" /><link rel="chapter" href="tutorial-traversal.html" title="Chapter 8. The Traversal Framework" /><link rel="chapter" href="domain-modeling-gallery.html" title="Chapter 9. Domain Modeling Gallery" /><link rel="chapter" href="languages.html" title="Chapter 10. Languages" /><link rel="chapter" href="tutorials-python-embedded.html" title="Chapter 11. Using Neo4j embedded in Python applications" /><link rel="part" href="reference-documentation.html" title="Part III. Reference" /><link rel="chapter" href="capabilities.html" title="Chapter 12. Capabilities" /><link rel="chapter" href="transactions.html" title="Chapter 13. Transaction Management" /><link rel="chapter" href="import.html" title="Chapter 14. Data Import" /><link rel="chapter" href="indexing.html" title="Chapter 15. Indexing" /><link rel="chapter" href="cypher-query-lang.html" title="Chapter 16. Cypher Query Language" /><link rel="chapter" href="graph-algo.html" title="Chapter 17. Graph Algorithms" /><link rel="chapter" href="server.html" title="Chapter 18. Neo4j Server" /><link rel="chapter" href="rest-api.html" title="Chapter 19. REST API" /><link rel="chapter" href="python-embedded.html" title="Chapter 20. Python embedded bindings" /><link rel="part" href="operations.html" title="Part IV. Operations" /><link rel="chapter" href="deployment.html" title="Chapter 21. Installation &amp; Deployment" /><link rel="chapter" href="embedded-configuration.html" title="Chapter 22. Configuration &amp; Performance" /><link rel="chapter" href="ha.html" title="Chapter 23. High Availability" /><link rel="chapter" href="operations-backup.html" title="Chapter 24. Backup" /><link rel="chapter" href="operations-security.html" title="Chapter 25. Security" /><link rel="chapter" href="operations-monitoring.html" title="Chapter 26. Monitoring" /><link rel="part" href="tools.html" title="Part V. Tools" /><link rel="chapter" href="tools-webadmin.html" title="Chapter 27. Web Administration" /><link rel="chapter" href="shell.html" title="Chapter 28. Neo4j Shell" /><link rel="part" href="community.html" title="Part VI. Community" /><link rel="chapter" href="community-support.html" title="Chapter 29. Community Support" /><link rel="chapter" href="community-contributing.html" title="Chapter 30. Contributing to Neo4j" /><link rel="appendix" href="manpages.html" title="Appendix A. Manpages" /><link rel="refentry" href="re01.html" title="neo4j" /><link rel="refentry" href="re02.html" title="neo4j-shell" /><link rel="refentry" href="re03.html" title="neo4j-backup" /><link rel="refentry" href="re04.html" title="neo4j-coordinator" /><link rel="refentry" href="re05.html" title="neo4j-coordinator-shell" /><link rel="appendix" href="questions.html" title="Appendix B. Questions &amp; Answers" /><link rel="subsection" href="security-server.html#_secure_the_port_and_remote_client_connection_accepts" title="25.1.1. Secure the port and remote client connection accepts" /><link rel="subsection" href="security-server.html#_arbitrary_code_execution" title="25.1.2. Arbitrary code execution" /><link rel="subsection" href="security-server.html#_https_support" title="25.1.3. HTTPS support" /><link rel="subsection" href="security-server.html#_server_authorization_rules" title="25.1.4. Server Authorization Rules" /><link rel="subsection" href="security-server.html#_hosted_scripting" title="25.1.5. Hosted Scripting" /><link rel="subsection" href="security-server.html#_security_in_depth" title="25.1.6. Security in Depth" /><link rel="subsection" href="security-server.html#_rewriting_urls_with_a_proxy_installation" title="25.1.7. Rewriting URLs with a Proxy installation" /><link rel="copyright" href="ln-id464096.html" title="License: Creative Commons 3.0" />


<!-- favicon -->

<link rel="shortcut icon" href="http://neo4j.org/favicon.ico" type="image/vnd.microsoft.icon" />
<link rel="icon" href="http://neo4j.org/favicon.ico" type="image/x-icon" />

<!-- style -->

<link href="css/shCore.css" rel="stylesheet" type="text/css" />
<link href="css/shCoreEclipse.css" rel="stylesheet" type="text/css" />
<link href="css/shThemeEclipse.css" rel="stylesheet" type="text/css" />
<link href="css/neo.css" rel="stylesheet" type="text/css" />

<!-- Syntax Highlighter -->

<script type="text/javascript" src="js/shCore.js"></script>
<script type="text/javascript" src="js/shBrushJava.js"></script>
<script type="text/javascript" src="js/shBrushJScript.js"></script>
<script type="text/javascript" src="js/shBrushBash.js"></script>
<script type="text/javascript" src="js/shBrushPlain.js"></script>
<script type="text/javascript" src="js/shBrushXml.js"></script>
<script type="text/javascript" src="js/shBrushGroovy.js"></script>
<script type="text/javascript" src="js/shBrushCypher.js"></script>
<script type="text/javascript" src="js/shBrushScala.js"></script>
<script type="text/javascript" src="js/shBrushSql.js"></script>
<script type="text/javascript" src="js/shBrushPython.js"></script>

<!-- activate when needed
<script type="text/javascript" src="js/shBrushRuby.js"></script>
<script type="text/javascript" src="js/shBrushCSharp.js"></script>
-->
 
<script type="text/javascript">
  SyntaxHighlighter.defaults['tab-size'] = 4;
  SyntaxHighlighter.defaults['gutter'] = false;
  SyntaxHighlighter.defaults['toolbar'] = false;
  SyntaxHighlighter.all()
</script>

<!-- JQuery -->

<script type="text/javascript" src="js/jquery-1.6.4.min.js"></script>

<!-- Replace SVG for browsers that lack support. -->
<script type="text/javascript" src="js/svgreplacer.js"></script>

<!-- Image Scaler -->

<script type="text/javascript" src="js/imagescaler.js"></script>

<!-- Table Styler -->

<script type="text/javascript" src="js/tablestyler.js"></script>

<!-- Version -->

<script type="text/javascript" src="js/version.js"></script>

<!-- Offline Sidebar -->

<script type="text/javascript" src="js/sidebar.js"></script>


<div xmlns="" class="breadcrumbs"><span class="breadcrumb-link"><a href="index.html">The Neo4j Manual</a></span> &gt; <span class="breadcrumb-link"><a href="operations.html">Operations</a></span> &gt; <span class="breadcrumb-link"><a href="operations-security.html">Security</a></span> &gt; <span class="breadcrumb-node">Securing access to the Neo4j Server</span></div></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><td width="20%" align="left"><a accesskey="p" href="operations-security.html">Prev</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="operations-monitoring.html">Next</a></td></tr></table><hr /></div><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="security-server"></a>25.1. Securing access to the Neo4j Server</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="security-server.html#_secure_the_port_and_remote_client_connection_accepts">25.1.1. Secure the port and remote client connection accepts</a></span></dt><dt><span class="section"><a href="security-server.html#_arbitrary_code_execution">25.1.2. Arbitrary code execution</a></span></dt><dt><span class="section"><a href="security-server.html#_https_support">25.1.3. HTTPS support</a></span></dt><dt><span class="section"><a href="security-server.html#_server_authorization_rules">25.1.4. Server Authorization Rules</a></span></dt><dt><span class="section"><a href="security-server.html#_hosted_scripting">25.1.5. Hosted Scripting</a></span></dt><dt><span class="section"><a href="security-server.html#_security_in_depth">25.1.6. Security in Depth</a></span></dt><dt><span class="section"><a href="security-server.html#_rewriting_urls_with_a_proxy_installation">25.1.7. Rewriting URLs with a Proxy installation</a></span></dt></dl></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_secure_the_port_and_remote_client_connection_accepts"></a>25.1.1. Secure the port and remote client connection accepts</h3></div></div></div><p>By default, the Neo4j Server is bundled with a Web server that binds to host <code class="literal">localhost</code> on port <code class="literal">7474</code>, answering only requests from the local machine.</p><p>This is configured in the <code class="literal">conf/neo4j-server.properties</code> file:</p><pre class="programlisting brush: plain"># http port (for all data, administrative, and UI access)
org.neo4j.server.webserver.port=7474

#let the webserver only listen on the specified IP. Default
#is localhost (only accept local connections). Uncomment to allow
#any connection.
#org.neo4j.server.webserver.address=0.0.0.0</pre><p>If you need to enable access from external hosts, configure the Web server in the <code class="literal">conf/neo4j-server.properties</code> by setting the property <code class="literal">org.neo4j.server.webserver.address=0.0.0.0</code> to enable access from any host.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_arbitrary_code_execution"></a>25.1.2. Arbitrary code execution</h3></div></div></div><p>By default, the Neo4j Server comes with some places where arbitrary code code execution can happen. These are the <a class="xref" href="gremlin-plugin.html" title="19.17. Gremlin Plugin">Section 19.17, “Gremlin Plugin”</a> and the <a class="xref" href="rest-api-traverse.html" title="19.11. Traversals">Section 19.11, “Traversals”</a> REST endpoints.
To secure these, either disable them completely by removing the offending plugins from the server classpath, or secure access to these URLs through proxies or Authorization Rules.
Also, the <a class="ulink" href="http://docs.oracle.com/javase/1.4.2/docs/api/java/lang/SecurityManager.html" target="_top">Java Security Manager</a> can be used to secure parts of the codebase.</p></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_https_support"></a>25.1.3. HTTPS support</h3></div></div></div><p>The Neo4j server includes built in support for SSL encrypted communication over HTTPS.
The first time the server starts, it automatically generates a self-signed ssl certificate and a private key.
Because the certificate is self signed, it is not safe to rely on for production use, instead, you should provide your own key and certificate for the server to use.</p><p>To provide your own key and certificate, replace the generated key and certificate, or change the neo4j-server.properties file to set the location of your certififacate and key:</p><pre class="programlisting brush: plain"># Certificate location (auto generated if the file does not exist)
org.neo4j.server.webserver.https.cert.location=ssl/snakeoil.cert

# Private key location (auto generated if the file does not exist)
org.neo4j.server.webserver.https.key.location=ssl/snakeoil.key</pre><p>Note that the key should be unencrypted.
Make sure you set correct permissions to the private key, so that only the neo4j server user can read/write it.</p><p>You can set what port the https connector should bind to in the same configuration file, as well as turn https off:</p><pre class="programlisting brush: plain"># Turn https-support on/off
org.neo4j.server.webserver.https.enabled=true

# https port (for all data, administrative, and UI access)
org.neo4j.server.webserver.https.port=443</pre></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_server_authorization_rules"></a>25.1.4. Server Authorization Rules</h3></div></div></div><p>Administrators may require more fine-grained security policies in addition to IP-level restrictions on the Web server.  Neo4j server supports
administrators in allowing or disallowing access the specific aspects of the database based on credentials that users or applications provide.</p><p>To facilitate domain-specific authorization policies in Neo4j Server, SecurityRules can be implemented and
registered with the server. This makes scenarios like user and role based security and
authentication against external lookup services possible.</p><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="ops-enforcing-server-authorization-rules"></a>Enforcing Server Authorization Rules</h4></div></div></div><p>In this example, a (dummy) failing security rule is registered to deny
access to all URIs to the server by listing the rules class in
<span class="emphasis"><em>neo4j-server.properties</em></span>:</p><pre class="programlisting brush: plain">org.neo4j.server.rest.security_rules=my.rules.PermanentlyFailingSecurityRule</pre><p>with the rule source code of:</p><pre class="programlisting brush: java">public class PermanentlyFailingSecurityRule implements SecurityRule
{

    public static final String REALM = "WallyWorld"; // as per RFC2617 :-)

    @Override
    public boolean isAuthorized( HttpServletRequest request )
    {
        return false; // always fails - a production implementation performs
                      // deployment-specific authorization logic here
    }

    @Override
    public String forUriPath()
    {
        return SecurityRule.DEFAULT_DATABASE_PATH;
    }

    @Override
    public String wwwAuthenticateHeader()
    {
        return SecurityFilter.basicAuthenticationResponse(REALM);
    }
}
</pre><p>With this rule registered, any access to the server will be
denied. In a production-quality implementation the rule
will likely lookup credentials/claims in a 3rd party
directory service (e.g. LDAP) or in a local database of
authorized users.</p><p><span class="emphasis"><em>Example request</em></span></p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<span class="strong"><strong><code class="literal">POST</code></strong></span>  <code class="literal">http://localhost:7474/db/data/node</code>
</li><li class="listitem">
<span class="strong"><strong><code class="literal">Accept:</code></strong></span> <code class="literal">application/json</code>
</li></ul></div><p><span class="emphasis"><em>Example response</em></span></p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<span class="strong"><strong><code class="literal">401:</code></strong></span> <code class="literal">Unauthorized</code>
</li><li class="listitem">
<span class="strong"><strong><code class="literal">WWW-Authenticate:</code></strong></span> <code class="literal">Basic realm="WallyWorld"</code>
</li></ul></div><pre class="programlisting brush: javascript"></pre></div><div class="section"><div class="titlepage"><div><div><h4 class="title"><a id="ops-using-wildcards-to-target-security-rules"></a>Using Wildcards to Target Security Rules</h4></div></div></div><p>In this example, a (dummy) failing security rule is registered to deny
access to all URIs to the server by listing the rule(s) class(es) in
<code class="literal">neo4j-server.properties</code>
In this case, the rule is registered
using a wildcard URI path (where * characters can be used to signify
any part of the path). For example <code class="literal">/users*</code> means the rule
will be bound to any resources under the <code class="literal">/users</code> root path. Similarly
<code class="literal">/users*type*</code> will bind the rule to resources matching
the URIs like <code class="literal">/users/fred/type/premium</code></p><pre class="programlisting brush: plain">org.neo4j.server.rest.security_rules=my.rules.PermanentlyFailingSecurityRuleWithWildcardPath</pre><p>with the rule source code of:</p><pre class="programlisting brush: java">public String forUriPath()
{
    return "/protected/*";
}
</pre><p>With this rule registered, any access to the server will be
denied. Using wildcards allows flexible targeting of security rules to
arbitrary parts of the server’s API, including any unmanaged extensions or managed
plugins that have been registered.</p><p><span class="emphasis"><em>Example request</em></span></p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<span class="strong"><strong><code class="literal">GET</code></strong></span>  <code class="literal">http://localhost:7474/protected/wildcard_replacement/x/y/z/something/else/more_wildcard_replacement/a/b/c/final/bit/more/stuff</code>
</li><li class="listitem">
<span class="strong"><strong><code class="literal">Accept:</code></strong></span> <code class="literal">text/plain</code>
</li></ul></div><p><span class="emphasis"><em>Example response</em></span></p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem">
<span class="strong"><strong><code class="literal">401:</code></strong></span> <code class="literal">Unauthorized</code>
</li><li class="listitem">
<span class="strong"><strong><code class="literal">WWW-Authenticate:</code></strong></span> <code class="literal">Basic realm="WallyWorld"</code>
</li></ul></div><pre class="programlisting brush: javascript"></pre></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_hosted_scripting"></a>25.1.5. Hosted Scripting</h3></div></div></div><div class="important" style="margin-left: 0; margin-right: 10%;"><table border="0" summary="Important"><tr><td rowspan="2" align="center" valign="top" width="25"><img alt="[Important]" src="images/icons/admon/important.png" /></td><th align="left">Important</th></tr><tr><td align="left" valign="top"><p>The neo4j server exposes remote scripting functionality by default that allow full access to the underlying system.
Exposing your server without implementing a security layer poses a substantial security vulnerability.</p></td></tr></table></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_security_in_depth"></a>25.1.6. Security in Depth</h3></div></div></div><p>Although the Neo4j server has a number of security features built-in (see the above chapters), for sensitive deployments it is often sensible to front against the outside world it with a proxy like Apache <code class="literal">mod_proxy</code> <sup>[<a id="id581818" href="#ftn.id581818" class="footnote">3</a>]</sup>.</p><p>This provides a number of advantages:</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
Control access to the Neo4j server to specific IP addresses, URL patterns and IP ranges. This can be used to make for instance only the <code class="literal">/db/data</code> namespace accessible to non-local clients, while the <code class="literal">/db/admin</code> URLs only respond to a specific IP address.
</p><pre class="programlisting brush: plain">&lt;Proxy *&gt;
  Order Deny,Allow
  Deny from all
  Allow from 192.168.0
&lt;/Proxy&gt;</pre></li></ul></div><p>While equivalent functionality can be implemented with Neo4j’s <code class="literal">SecurityRule</code> plugins (see above), for operations professionals configuring servers like Apache is often preferable to developing plugins. However it should be noted that where both approaches are used, they will work harmoniously providing the behavior is consistent across proxy server and <code class="literal">SecurityRule</code> plugins.</p><div class="itemizedlist"><ul class="itemizedlist" type="disc"><li class="listitem"><p class="simpara">
Run Neo4j Server as a non-root user on a Linux/Unix system on a port &lt; 1000 (e.g. port 80) using
</p><pre class="programlisting brush: plain">ProxyPass /neo4jdb/data http://localhost:7474/db/data
ProxyPassReverse /neo4jdb/data http://localhost:7474/db/data</pre></li><li class="listitem"><p class="simpara">
Simple load balancing in a clustered environment to load-balance read load using the Apache <code class="literal">mod_proxy_balancer</code> <sup>[<a id="id581919" href="#ftn.id581919" class="footnote">4</a>]</sup> plugin
</p><pre class="programlisting brush: plain">&lt;Proxy balancer://mycluster&gt;
BalancerMember http://192.168.1.50:80
BalancerMember http://192.168.1.51:80
&lt;/Proxy&gt;
ProxyPass /test balancer://mycluster</pre></li></ul></div></div><div class="section"><div class="titlepage"><div><div><h3 class="title"><a id="_rewriting_urls_with_a_proxy_installation"></a>25.1.7. Rewriting URLs with a Proxy installation</h3></div></div></div><p>When installing Neo4j Server behind proxies, you need to enable rewriting of the JSON calls,
otherwise they will point back to the servers own base URL (normally <a class="ulink" href="http://localhost:7474" target="_top">http://localhost:7474</a>).</p><p>To do this, you can use <a class="ulink" href="http://httpd.apache.org/docs/2.2/mod/mod_substitute.html" target="_top">Apache mod_substitute</a></p><pre class="programlisting brush: plain">ProxyPass / http://localhost:7474/
ProxyPassReverse / http://localhost:7474/
&lt;Location /&gt;
    AddOutputFilterByType SUBSTITUTE application/json
    AddOutputFilterByType SUBSTITUTE text/html
    Substitute s/localhost:7474/myproxy.example.com/n
    Substitute s/http/https/n
&lt;/Location&gt;</pre></div><div class="footnotes"><br /><hr width="100" align="left" /><div class="footnote"><p><sup>[<a id="ftn.id581818" href="#id581818" class="simpara">3</a>] </sup><a class="ulink" href="http://httpd.apache.org/docs/2.2/mod/mod_proxy.html" target="_top">http://httpd.apache.org/docs/2.2/mod/mod_proxy.html</a></p></div><div class="footnote"><p><sup>[<a id="ftn.id581919" href="#id581919" class="simpara">4</a>] </sup><a class="ulink" href="http://httpd.apache.org/docs/2.2/mod/mod_proxy_balancer.html" target="_top">http://httpd.apache.org/docs/2.2/mod/mod_proxy_balancer.html</a></p></div></div></div><HR xmlns=""></HR><a xmlns="" href="ln-id464096.html"><p xmlns="http://www.w3.org/1999/xhtml" class="copyright">Copyright © 2012 Neo Technology</p></a><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="operations-security.html">Prev</a> </td><td width="20%" align="center"><a accesskey="u" href="operations-security.html">Up</a></td><td width="40%" align="right"> <a accesskey="n" href="operations-monitoring.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top"> </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> </td></tr></table></div></body></html>
